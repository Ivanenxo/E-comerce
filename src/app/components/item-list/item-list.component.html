<div class="max-w-md mx-auto p-8 bg-white shadow-md rounded-lg space-y-4">
  <div class="flex flex-col">
    <label for="param2" class="text-gray-700 font-semibold mb-1">Producto:</label>
    <input
      id="param2"
      [(ngModel)]="param2"
      placeholder="Escribe el nombre o referencia del producto"
      class="p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
    />
  </div>

  <button
    class="w-full p-2 mt-4 text-white bg-orange-300 rounded hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
    (click)="onSearch(); closeDetail()"
  >
    Buscar
  </button>
</div>

<!-- Carrusel de productos favoritos -->
<div *ngIf="(itemsFav?.length ?? 0) > 0" class="max-w-6xl mx-auto mt-8">
  <h2 class="text-xl font-bold text-[#0d2744] mb-4">Productos recomendados</h2>

  <div class="relative overflow-hidden">
    <div
      #carouselContainer
      class="flex overflow-x-auto space-x-4 scrollbar-hide scroll-smooth"
      (mouseenter)="stopAutoScroll()"
      (mouseleave)="startAutoScroll()"
    >
      <div
        *ngFor="let item of itemsFav"
        class="min-w-[200px] bg-white shadow-md rounded-lg overflow-hidden flex-shrink-0 cursor-pointer hover:shadow-lg transition"
        (click)="selectItem(item)"
      >
        <img
          [src]="apiUrl + 'api/Productos/foto/' + item.Codigo + '-1.jpg'"
          alt="{{item.Nombre}}"
          (error)="onImageError($event)"
          class="w-full h-32 object-contain bg-gray-50"
        />
        <div class="p-3 text-center">
          <p class="text-sm font-semibold text-gray-800">
            {{ item.PrecioVenta | currency:'$':'symbol':'1.0-0' }}
          </p>
        </div>
      </div>
    </div>
  </div>
</div>



<div *ngIf="selectedItem; else itemList">
  <!-- Detalles del ítem seleccionado -->
  <div class="max-w-md mx-auto p-8 bg-white shadow-md rounded-lg">
    <h2 class="text-2xl font-bold text-[#0d2744] mb-4">{{ selectedItem.Nombre }}</h2>
    <img src="{{apiUrl}}api/Productos/foto/{{selectedItem.Codigo}}-1.jpg" alt="Imagen" (error)="onImageError($event)">
    <p class="text-lg mt-4"><strong>Precio:</strong> {{ selectedItem.PrecioVenta | currency }}</p>
    <p class="text-sm mt-2"><strong>Serie:</strong> {{ selectedItem.Serie }}</p>
    <p class="text-sm mt-2"><strong>Referencia:</strong> {{ selectedItem.Referencia }}</p>
    <p class="text-sm mt-2"><strong>Disponibilidad:</strong> {{ selectedItem.Disponibilidad }}</p>
    <strong> <a href="javascript:void(0)" (click)="infoprod(selectedItem.DataSheet)">Ver Ficha Técnica</a> </strong>
    <button
      class="w-full p-2 mt-4 text-white bg-green-500 rounded hover:bg-green-600 focus:outline-none"
      (click)="addToCart(selectedItem.Codigo)"
    >
      Añadir al carrito
    </button>

    <button
      class="w-full p-2 mt-4 text-white bg-blue-500 rounded hover:bg-blue-600 focus:outline-none"
      (click)="closeDetail()"
    >
      Volver a la lista
    </button>
  </div>
</div>

<ng-template #itemList>
  <div class="flex flex-col md:flex-row w-full gap-4">
    <aside class="hidden md:block w-full md:w-1/4 min-w-[280px] max-w-[420px] bg-white border-r p-4 sticky top-0"
    >
      <h2 class="text-lg font-bold text-[#0d2744] mb-4">Filtros</h2>

      <div class="mb-6">
        <p class="font-semibold mb-2">Marca</p>

        <div class="space-y-2 max-h-48 overflow-y-auto">
          <ng-container *ngFor="let marca of marcas">
            <label
              *ngIf="(displayedItems[marca]?.length || 0) > 0"
              class="flex items-center gap-2 text-sm cursor-pointer justify-between"
            >
              <div class="flex items-center gap-2">
                <input
                  type="checkbox"
                  [checked]="marcasSeleccionadas.includes(marca)"
                  (change)="toggleMarca(marca, $event)"
                  class="accent-blue-600"
                />
                <span>{{ marca }}</span>
              </div>

              <span class="text-gray-400 text-xs">
                ({{ displayedItems[marca]?.length }})
              </span>
            </label>
          </ng-container>
        </div>
      </div>
         <!-- FILTRO PRECIO -->
<div class="mb-6">
  <p class="font-semibold mb-3">Precio</p>

  <!-- INPUTS -->
  <div class="flex gap-2 mb-3">
    <input
      type="number"
      [(ngModel)]="precioMin"
      (change)="onPrecioMinChange()"
      class="w-1/2 p-2 border rounded"
    />
    <input
      type="number"
      [(ngModel)]="precioMax"
      (change)="onPrecioMaxChange()"
      class="w-1/2 p-2 border rounded"
    />
  </div>

  <!-- SLIDERS -->
  <div class="relative h-6">
    <!-- Slider MIN -->
    <input
      type="range"
      [min]="precioRangoMin"
      [max]="precioRangoMax"
      [(ngModel)]="precioMin"
      (input)="onPrecioMinChange()"
      class="absolute w-full pointer-events-none appearance-none accent-blue-600"
      style="pointer-events:auto"
    />

    <!-- Slider MAX -->
    <input
      type="range"
      [min]="precioRangoMin"
      [max]="precioRangoMax"
      [(ngModel)]="precioMax"
      (input)="onPrecioMaxChange()"
      class="absolute w-full pointer-events-none appearance-none accent-orange-500"
      style="pointer-events:auto"
    />
  </div>

  <!-- RANGO VISUAL -->
  <p class="text-sm mt-2 text-gray-600">
    {{ precioMin | currency:'$':'symbol':'1.0-0' }} —
    {{ precioMax | currency:'$':'symbol':'1.0-0' }}
  </p>
</div>

          <button
            class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700"
            (click)="aplicarFiltros()"
          >
            Aplicar filtros
          </button>

          <button
            class="w-full mt-2 border py-2 rounded"
            (click)="limpiarFiltros()"
          >
            Limpiar
          </button>
    </aside>
    <button
  class="md:hidden fixed bottom-4 right-4 z-50 bg-blue-600 text-white px-4 py-3 rounded-full shadow-lg"
  (click)="showMobileFilters = true"
>
  Filtros
</button>

    <div
    *ngIf="showMobileFilters"
    class="fixed inset-0 z-50 bg-black/40 md:hidden"
    >
    <div class="absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl p-4 max-h-[85vh] overflow-y-auto">

      <div class="flex justify-between items-center mb-4">
        <h2 class="text-lg font-bold">Filtros</h2>
        <button
          class="text-gray-500"
          (click)="showMobileFilters = false"
        >
          ✕
        </button>
      </div>


      <h2 class="text-lg font-bold text-[#0d2744] mb-4">Filtros</h2>

      <div class="mb-6">
        <p class="font-semibold mb-2">Marca</p>

        <div class="space-y-2 max-h-48 overflow-y-auto">
          <ng-container *ngFor="let marca of marcas">
            <label
              *ngIf="(displayedItems[marca]?.length || 0) > 0"
              class="flex items-center gap-2 text-sm cursor-pointer justify-between"
            >
              <div class="flex items-center gap-2">
                <input
                  type="checkbox"
                  [checked]="marcasSeleccionadas.includes(marca)"
                  (change)="toggleMarca(marca, $event)"
                  class="accent-blue-600"
                />
                <span>{{ marca }}</span>
              </div>

              <span class="text-gray-400 text-xs">
                ({{ displayedItems[marca]?.length }})
              </span>
            </label>
          </ng-container>
        </div>
      </div>
         <!-- FILTRO PRECIO -->
<div class="mb-6">
  <p class="font-semibold mb-3">Precio</p>

  <!-- INPUTS -->
  <div class="flex gap-2 mb-3">
    <input
      type="number"
      [(ngModel)]="precioMin"
      (change)="onPrecioMinChange()"
      class="w-1/2 p-2 border rounded"
    />
    <input
      type="number"
      [(ngModel)]="precioMax"
      (change)="onPrecioMaxChange()"
      class="w-1/2 p-2 border rounded"
    />
  </div>

  <!-- SLIDERS -->
  <div class="relative h-6">
    <!-- Slider MIN -->
    <input
      type="range"
      [min]="precioRangoMin"
      [max]="precioRangoMax"
      [(ngModel)]="precioMin"
      (input)="onPrecioMinChange()"
      class="absolute w-full pointer-events-none appearance-none accent-blue-600"
      style="pointer-events:auto"
    />

    <!-- Slider MAX -->
    <input
      type="range"
      [min]="precioRangoMin"
      [max]="precioRangoMax"
      [(ngModel)]="precioMax"
      (input)="onPrecioMaxChange()"
      class="absolute w-full pointer-events-none appearance-none accent-orange-500"
      style="pointer-events:auto"
    />
  </div>

  <!-- RANGO VISUAL -->
  <p class="text-sm mt-2 text-gray-600">
    {{ precioMin | currency:'$':'symbol':'1.0-0' }} —
    {{ precioMax | currency:'$':'symbol':'1.0-0' }}
  </p>
</div>

          

    </div>
    </div>

    <div *ngIf="searchExecuted && items.length > 0; else noItems" class="w-3/4">



      <div *ngFor="let marca of displayedItems  | keyvalue">
        <h3 class="text-lg font-bold underline text-[#0d2744] flex items-center">{{ marca.key }}</h3>
        <ul class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 lg:grid-cols-4 gap-6 p-4">
          <li *ngFor="let item of marca.value">
            <div class="bg-white shadow-md rounded-lg overflow-hidden p-4 relative h-100" >
              <div class="relative z-10">
                <div class="bg-white shadow-md rounded-lg overflow-hidden">
                  <!-- Imagen del producto -->
                  <img
                    [src]="apiUrl + 'api/Productos/foto/' + item.Codigo + '-1.jpg'"
                    alt="Imagen"
                    (error)="onImageError($event)"
                    class="w-full h-32 object-contain rounded-t-lg"
                    (click)="selectItem(item)"
                  />
                  <!-- Logo de la marca -->
                  <div class="flex justify-center p-2 bg-gray-50">
                    <img
                      [src]="getLogoUrl(item.Marca)"
                      alt="{{ item.Marca }}"
                      class="h-10 object-contain"
                    />
                  </div>
                </div>

                <h3 class="line-clamp" title="{{ item.Nombre }}" (click)="selectItem(item)">
                  <strong> {{ item.Nombre }} </strong>
                </h3>
                <p class="text-sm dark:text-[#bfddf8] mt-2">
                  <strong> {{item.PrecioVenta | currency:'$':'symbol':'1.2-2' }}</strong> <br>
                  Serie: {{item.Serie}} <br>
                  Referencia: {{item.Referencia}} <br>
                  Codigo: {{item.Codigo}} <br>
                <strong> <a href="javascript:void(0)" (click)="infoprod(item.DataSheet)">Ver Ficha Técnica</a> </strong>
                </p>
                <p class="text-sm text-[#143e66] dark:text-[#bfddf8] mt-2" [ngClass]="{'text-verde': item.Disponibilidad === 'DISPONIBLE', 'text-rojo': item.Disponibilidad === 'CONSULTAR_ASESOR'}">
                  Disponibilidad : <strong> {{item.Disponibilidad}} </strong>
                </p>
              </div>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #noItems>
  <p *ngIf="searchExecuted">No se encontraron items.</p>
</ng-template>
